<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <title>Drowsiness Detection</title>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-lg-8  offset-lg-2">
            <h3 class="mt-5">Drowsiness detection</h3>                
            <!-- <img src="{{ url_for('video_feed') }}" width="100%"> -->
            <video id="video-stream" width="640" height="480" autoplay></video>
            <img src="#" id="processed-image" width="640" height="480" >
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.min.js"></script>
<script>
  // Connect to the WebSocket server
  var socket = io.connect('http://' + document.domain + ':' + location.port);
  console.log(socket);

  // Receive processed images from the server
  socket.on('image', function(data) {
    var img = document.getElementById('processed-image');
    img.src = 'data:image/jpeg;base64,' + data;
  });

  // Get the video stream from the camera
  navigator.mediaDevices.getUserMedia({video: true})
    .then(function(stream) {
      var video = document.getElementById('video-stream');
      video.srcObject = stream;

      // Send video frames to the server for processing
      var canvas = document.createElement('canvas');
      var ctx = canvas.getContext('2d');
      canvas.width = 640;
      canvas.height = 480;
      var frameCount = 0;
      setInterval(function() {
        console.log(video.videoWidth, video.videoHeight);
        ctx.drawImage(video, 0, 0);
        var dataURL = canvas.toDataURL('image/jpeg');
        socket.emit('frame', dataURL);
        frameCount++;
      }, 1000 / 10);
    })
    .catch(function(error) {
      console.log(error);
    });
</script>
</body>
</html>